
<html>
	<head>
		<script src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<link rel="stylesheet" href="css/graph.css">
		<link href='https://fonts.googleapis.com/css?family=Lato:200,400,900italic,900,700italic,700,400italic,300italic,300,100italic,100' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Alegreya+Sans:400,300,100,500,700' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">


		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
	</head>
	<body>



	<div id = "graph-page">



		<div class="section intro">
			<div class="section-fixed">
				<div class="col12">
					<h1> Modelling the Zombie Apocalypse</h1>
				</div>
				
				<div class="col8">
					<p>Bespoke typewriter bicycle rights, franzen XOXO tacos celiac normcore. Umami slow-carb poutine schlitz before they sold out, ennui kitsch chicharrones master cleanse humblebrag wolf craft beer sartorial echo park post-ironic. Roof party ramps organic church-key bespoke swag. Keffiyeh ennui gastropub occupy, pinterest four loko yuccie authentic meditation next level. Farm-to-table green juice pork belly, polaroid jean shorts humblebrag biodiesel gastropub. Green juice viral truffaut XOXO, kombucha +1 mumblecore tumblr pour-over poutine. Kinfolk celiac neutra freegan. </p> 
				</div>
			</div>
		</div>

		<div class="section test-cases">
			<div class="section-fixed">
				<div class="col12">
					<h2>Some interesting scenarios</h2>
				</div>
			</div>

			<div class="section-fixed">
				<div class="col4">
					<div class="case left"></div>
				</div>
				<div class="col4">
					<div class="case center"></div>
				</div>
				<div class="col4">
					<div class="case right"></div>
				</div>
			</div>
		</div>
		
		<div id="graph" class="aGraph" ></div>

		<div class="input-fields">
			<div class="box">
			  <div class="container-1">
			      <!-- <span class="icon"><i class="fa fa-search"></i></span> -->
			      <form id="myform" autocomplete="off" action="#">
			       <!--  <span class="icon"><i class="fa fa-search"></i></span> -->
			       <div class="input-line">
				       <!-- <p class="top">Initial population of humans</p> -->
				        <!-- <input type="text" id="h0"/> -->
				        <label for="humanpop"><p>Initial population of humans</p></label>
				        <div class="slider">
					        <input type="range" min="0" max="10000" value="50" id="h0" step="1" oninput="numberUpdate(value,id)">
					        <input type="number" id="h0o" min="0" max="10000" value="50" onChange="rangeUpdate(value,id)"></output>
				    	</div>
			    	</div>
			    	<div class="input-line">
				      <!--  <p>Initial population of zombies</p>
				        <input type="text" id="z0"/> -->
				        <label for="zombiepop"><p>Initial population of zombies</p></label>
				        <div class="slider">
				        <input type="range" min="0" max="10000" value="1000" id="z0" step="1" oninput="numberUpdate(value,id)">
						<input type="number" id="z0o" min="0" max="10000" value="1000"></input>
						</div>			    		
			    	</div>
			       <div class="input-line">
				       <!-- <p>Number of zombies killed per human/week</p>
				        <input type="text" id="a"/> -->
				        <label for="a"><p>Average number of zombies killed per human/week</p></label>
				        <div class="slider">
					        <input type="range" min="0" max="5" value=".5" id="a" step=".1" oninput="numberUpdate(value,id)">
					        <input type="number" id="ao" min="0" max="5" value=".5" step=".1"></input>
				    	</div>
			    	</div>
			        <div class="input-line">
				        <!-- <p>Zombie attacks on human/week</p>
				        <input type="text" id="b"/> -->
				        <label for="b"><p>Zombie attacks on human/week</p></label>
				        <div class="slider">
					        <input type="range" min="0" max=".1" value=".0001" id="b" step=".0001" oninput="numberUpdate(value,id)">
					        <input type="number" id="bo" min="0" max=".1" value=".0001" step=".0001"></input>
					    </div>
				    </div>
				    <div class="input-line">
				        <!-- <p>Proportion of population dying a natural death/week</p>
				        <input type="text" id="c"/> -->
				        <label for="c"><p>Proportion of population dying a natural death/week</p></label>
				        <div class="slider">
					        <input type="range" min="0" max="1" value=".02" id="c" step=".01" oninput="numberUpdate(value,id)">
					        <input type="number" id="co" min="0" max="1" value=".02" step=".01"></input>
					    </div>
				    </div>
			        <div class="input-line">
				       <!--  <p>Proportion of fights ending in death, not a new a zombie</p>
				        <input type="text" id="d"/> -->
				        <label for="d"><p>Proportion of fights ending in death, not a new a zombie</p></label>
				        <div class="slider">
					        <input type="range" min="0" max="1" value=".1" id="d" step=".1" oninput="numberUpdate(value,id)">
					        <input type="number" id="do" min="0" max="1" value=".1" step=".1"></input>
					   	</div>
					</div>
				    <div class="input-line">
				        <!-- <p>Proportion of population giving birth/week</p>
				        <input type="text" id="e"/> -->
				        <label for="e"><p>Proportion of fights ending in death, not a new a zombie</p></label>
				        <div class="slider">
					        <input type="range" min="0" max="1" value=".1" id="e" step=".1" oninput="numberUpdate(value,id)">
					        <input type="number" id="eo" min="0" max="1" value=".1" step=".1"></input>
					   	</div>
					</div>
			        <div class="input-line">
				        <p>Weeks in Simulation</p>
				        <input type="number" id="it" min="0" value="10" step="1"/>
				    </div>

			        <div class="input-line">
			       		 <input type="submit" id ="submit" value="Run Simulation">
			    	</div>
			    </form>
			  </div>
			</div>
		</div>

		
	</div>


	<script>

	function numberUpdate(val, id) {
		document.querySelector('#'+id+'o').value = val;
	}

	function rangeUpdate(val, id) {
		newid = id.slice(0, id.length-1);
		document.querySelector('#'+newid).value = val;
	}

	$(".fa").on("click", function(event){
		var id = $(this).siblings("input").attr('id');
		var step = document.getElementById(id).step;
		var min = parseFloat(document.getElementById(id).min);
		var max = parseFloat(document.getElementById(id).max);
		var pts = step.length - 1;

		oldvalue = parseFloat($("#" + id).val());

		if ($(this).hasClass("fa-plus")) {
			newvalue = parseFloat((oldvalue + parseFloat(step)).toFixed(pts));
		}
		else {
			newvalue = parseFloat((oldvalue - parseFloat(step)).toFixed(pts));
		}

		if((newvalue>min) && (newvalue<max)) {
			$("#" + id).val(newvalue).change();
			document.querySelector('#'+id+'o').value = newvalue;
		}
		  
	});

	// $(".fa-minus").on("click", function(event){
	// 	var id = $(this).siblings("input").attr('id');
	// 	var step = document.getElementById(id).step;
	// 	var pts = step.length - 1;

	// 	oldvalue = parseFloat($("#" + id).val());
	// 	newvalue = (oldvalue - parseFloat(step)).toFixed(pts);
	// 	$("#" + id).val(newvalue).change();
	// 	document.querySelector('#'+id+'o').value = newvalue;
		  
	// });



	var hdata = [];
	var zdata = [];
	var a;
	var b;
	var c;
	var d;
	var e;
	var it;
	made_graph_already = 0;

	//draw graph 
	$( document ).ready(function() {
	    processData();
	});

	$("#myform").on("submit", function(event){
		event.preventDefault();

		processData();
		
	});

	function processData() {
		hdata = [];
		zdata = [];
		a=0;
		b=0;
		c=0;
		d=0;
		e=0;
		it=0;
		
		//no data
		// if ($('#h0').val() == "") {
		// 	h0 = 50;
		// 	z0 = 1000;
		// 	a = .5;
		// 	b=.0001;
		// 	c = .02;
		// 	d = 0;
		// 	e = .01;

		// 	// h0 = 0;
		// 	// z0 = 0;
		// 	// a = 0;
		// 	// b=0;
		// 	// c = 0;
		// 	// d = 0;
		// 	// e = 0;

		// 	for (i = 0; i <= 100; i++) {
		// 		hdata.push(h0);
		// 		zdata.push(z0);
		// 		result = run_model(h0, z0, a, b, c, d, e);
		// 		h0 = result[0];
		// 		z0 = result[1];

		// 	}
		// } 
		// 	else {
			h0 = parseFloat($('#h0').val());
			z0 = parseFloat($('#z0').val());


			a = parseFloat($('#a').val());
			b = parseFloat($('#b').val());
			c = parseFloat($('#c').val());
			d = parseFloat($('#d').val());
			e = parseFloat($('#e').val());

			if(it == 0) {
				it = 100;
			}
			else {
				it = parseFloat($('#it').val());
			}

			for (i = 0; i <= it; i++) {
				hdata.push(h0);
				zdata.push(z0);
				result = run_model(h0, z0, a, b, c, d, e);
				h0 = result[0];
				z0 = result[1];

			}
		// }
		draw(hdata, zdata);
	}

	var m, w, h;

	function draw(hvalues, zvalues) {
		d3.select("#graph")
			.html("");

		// define dimensions of graph
		m = [50, 40, 50, 80]; // margins
		w = $( window ).width()*.66 - m[1] - m[3] -10; // width
		h = window.innerHeight - m[0] - m[2] ; // height
		
		// X scale will fit all values from data[] within pixels 0-w
		var x = d3.scale.linear().domain([0, hvalues.length]).range([0, w]);
		
		// Y scale will fit values from 0-10 within pixels h-0 (Note the inverted domain for the y-scale: bigger is up!)
		var max;
		var max_of_humans = Math.max.apply(Math, hvalues);
		var max_of_zombies = Math.max.apply(Math, zvalues);
		if (max_of_humans>max_of_zombies) {
			max = max_of_humans;
		}
		else {
			max = max_of_zombies;
		}
		
		var y = d3.scale.linear().domain([0, max]).range([h, 0]);
		

		// create a line function that can convert data[] into x and y points
		var line = d3.svg.line()
			// .interpolate("cardinal") 
			// assign the X function to plot our line as we wish
			.x(function(d,i) { 
				// return the X coordinate where we want to plot this datapoint
				return x(i); 
			})
			.y(function(d) { 
				// return the Y coordinate where we want to plot this datapoint
				return y(d); 
			})
			// Add an SVG element with the desired dimensions and margin.
			var graph = d3.select("#graph").append("svg:svg")
				.attr("width", w + m[1] + m[3])
				.attr("height", h + m[0] + m[2])
				.append("svg:g")
				.attr("transform", "translate(" + m[3] + "," + m[0] + ")");
			// create xAxis
			var xAxis = d3.svg.axis().scale(x).tickSize(-h).tickSubdivide(true);
			// Add the x-axis.
			graph.append("svg:g")
			      .attr("class", "x axis")
			      .attr("transform", "translate(0," + h + ")")
			      .attr('fill', '#615F63')
			      .call(xAxis);
			// create left yAxis
			var yAxisLeft = d3.svg.axis().scale(y).ticks(4).orient("left");
			// Add the y-axis to the left
			graph.append("svg:g")
			      .attr("class", "y axis")
			      .attr("transform", "translate(0,0)")
			      .attr('fill', '#615F63')
			      .call(yAxisLeft);
			
  			// Add the line by appending an svg:path element with the data line we created above
			// do this AFTER the axes above so that the line is above the tick-lines
  			graph.append("svg:path")
  				.attr("d", line(hvalues))
  				.attr("class", "humans");
  			graph.append("svg:path")
  				.attr("d", line(zvalues))
  				.attr("class", "zombies");
  			made_graph_already= 1;

  			graph.append("svg:text")
  			    .attr("class", "x label")
  			    .attr("text-anchor", "end")
  			    .attr("x", w/2)
  			    .attr("y", h + 40)
  			    .text("Weeks")
  			    .attr('fill', 'white');

  			graph.append("svg:text")
  			    .attr("class", "y label")
  			    .attr("text-anchor", "end")
  			    .attr("x", -250)
  			    .attr("y", -70)
  			    .attr("dy", ".5em")
  			    .text("Population")
  			    .attr('fill', 'white')
  			    .attr("transform", "rotate(-90)");
  			    
	}

	function run_model (h0, z0, a, b, c, d, e) {
	    h1 = h0 + (e*h0) - (c*h0) - (b * h0 * z0);
	    z1 = z0 + (1 - d)*(b*h0*z0) - (a*h0);

	    if (h1 < 1){
	        h1 = 0;
	    }
	    if (z1 < 1){
	        z1 = 0
	    }

	    return [h1, z1];
	}
	
	//resize event 
	d3.select(window).on('resize', processData);




	// var hoverLineGroup = d3.select("g").append("g").attr("class", "hover-line");
	// // add the line to the group
	// var hoverLine = hoverLineGroup
	// 		.append("svg:line")
	// 			.attr("x1", 10).attr("x2", 10) // vertical line so same value on each
	// 			.attr("y1", 0).attr("y2", h)
	// 			.attr("fill", "green"); // top to bottom


	
	// add the line to the group
	// var hoverLine = d3.select("g")
	// 	.append("line")
	// 	.attr("class", "hover-line")
	// 	.attr("x1", 10).attr("x2", 10) // vertical line so same value on each
	// 	.attr("y1", 0).attr("y2", h)
	// 	.attr("fill", "green"); // top to bottom

	// console.log(d3.select("#graph"));

	var vertical = d3.select("#graph").selectAll("path")
	        .append("div")
	        .attr("class", "remove")
	        .style("position", "absolute")
	        .style("z-index", "19")
	        .style("width", "1px")
	        .style("height", "380px")
	        .style("top", "10px")
	        .style("bottom", "30px")
	        .style("left", "0px")
	        .style("background", "yellow");

	d3.select("#graph")
	     .on("mousemove", function(){  
	        mousex = d3.mouse(this);
	        mousex = mousex[0] + 5;
	        vertical.style("left", mousex + "px" )})
	     .on("mouseover", function(){  
	        mousex = d3.mouse(this);
	        mousex = mousex[0] + 5;
	        vertical.style("left", mousex + "px")});




	function mousemove() {

		console.log(d3.mouse(this));
	   /* var x0 = x.invert(d3.mouse(this)[0]),
	        i = bisectDate(data, x0, 1),
	        d0 = data[i - 1],
	        d1 = data[i],
	        d = x0 - d0.date > d1.date - x0 ? d1 : d0;*/
	    // focus.attr("transform", "translate(" + x(d.date) + "," + y(d.close) + ")");
	    // focus.select("text").text(formatCurrency(d.close));
	  }

	  

	// d3.select("svg").on("mousemove", mousemove); 


		

	
			
	</script>



	</body>
</html>